---
description: "é˜²æ­¢è¿‡åº¦è®¾è®¡ - è¯æ®ä¼˜å…ˆä¸å¤æ‚åº¦æ§åˆ¶ - è¯¦ç»†å‚è€ƒ"
scopes: [chat, edit]
tags: [anti-overengineering, evidence-first, complexity, decision-making, detailed-reference]
priority: 204
globs: []
alwaysApply: false
---

# é˜²æ­¢è¿‡åº¦è®¾è®¡ - è¯æ®ä¼˜å…ˆä¸å¤æ‚åº¦æ§åˆ¶ï¼ˆè¯¦ç»†å‚è€ƒï¼‰

> **æ³¨æ„**ï¼šæœ¬æ–‡ä»¶ä¸ºè¯¦ç»†å‚è€ƒï¼Œä¸ä¼šè‡ªåŠ¨åŠ è½½ã€‚  
> **è¾¨è¯æ€è€ƒé“å¾‹**ï¼šè§ `000-critical-rules.mdc` çš„"AI å·¥ä½œåŸåˆ™"éƒ¨åˆ†

---

> **æ ¸å¿ƒåŸåˆ™**: æ¯ä¸ªå†³ç­–å¿…é¡»æœ‰è¯æ®æ”¯æŒï¼Œä¼˜å…ˆä½¿ç”¨ç°æœ‰æ¨¡å¼ï¼Œé¿å…ä¸å¿…è¦çš„å¤æ‚æ€§

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

> **"Every decision must be backed by evidence from existing code, documentation, or verified sources."**

### ä¸‰å¤§æ”¯æŸ±
1. **è¯æ®ä¼˜å…ˆ** - åŸºäºç°æœ‰ä»£ç å’Œæ–‡æ¡£åšå†³ç­–
2. **å¤æ‚åº¦æ§åˆ¶** - é»˜è®¤é€‰æ‹©æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼ˆâ‰¤3/10 å¤æ‚åº¦ï¼‰
3. **æ¨¡å¼ä¸€è‡´æ€§** - éµå¾ªé¡¹ç›®ç°æœ‰æ¨¡å¼ï¼Œä¸éšæ„åˆ›æ–°

---

## ğŸ“‹ Evidence-First å†³ç­–æµç¨‹

### Before Proposing Any Solution

**å¿…é¡»å®Œæˆçš„æ­¥éª¤**ï¼š

1. **Find Existing Code** - æ‰¾åˆ° 2-3 ä¸ªç±»ä¼¼å®ç°çš„ä¾‹å­
2. **Cite Sources** - æä¾›æ–‡ä»¶è·¯å¾„å’Œè¡Œå·
3. **Explain Patterns** - æè¿°ç°æœ‰ä»£ç å¦‚ä½•å·¥ä½œ
4. **Justify Deviations** - è§£é‡Šä¸ºä»€ä¹ˆç°æœ‰æ¨¡å¼ä¸é€‚ç”¨ï¼ˆå¦‚æœåç¦»ï¼‰

### Evidence Quality Standards

| è¯æ®ç±»å‹ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|---------|--------|------|
| **Primary Evidence** | â­â­â­â­â­ | é¡¹ç›®ä¸­ç°æœ‰çš„å·¥ä½œä»£ç  |
| **Secondary Evidence** | â­â­â­â­ | Obsidian API æ–‡æ¡£ã€TypeScript æ–‡æ¡£ |
| **Tertiary Evidence** | â­â­â­ | ç¤¾åŒºæœ€ä½³å®è·µï¼ˆéœ€éªŒè¯ï¼‰ |
| **Never Accept** | âŒ | å‡è®¾ã€"å¸¸è¯†"ã€æœªç»æ”¯æŒçš„å£°æ˜ |

---

## ğŸš¨ Pre-Implementation Checks

### Rule 1: Evidence-First Analysis

**Before implementing ANY solution:**

```markdown
1. âœ… Find existing working code that solves similar problems
   - File: `src/ChatView.ts:123-145`
   - Pattern: Uses ItemView for custom views
   
2. âœ… Cite file paths + line numbers
   - Show me the exact code reference
   
3. âœ… Show me the existing pattern
   - How does it currently work?
   - What dependencies does it have?
   
4. âœ… Explain WHY that pattern won't work for this case
   - Be specific about the limitations
   - Provide evidence, not assumptions
   
5. âœ… Only then propose minimal changes
   - Build on existing patterns
   - Minimize new abstractions
```

### Rule 2: Complexity Rating System

**Rate every solution complexity 1-10:**

| Rating | Category | Action Required |
|--------|----------|----------------|
| **1-3** | ç®€å•ï¼ˆé¦–é€‰ï¼‰ | ä½¿ç”¨ç°æœ‰æ¨¡å¼ï¼Œç›´æ¥å®ç° |
| **4-6** | ä¸­ç­‰ | éœ€è¦ä¹¦é¢è¯´æ˜ç†ç”± |
| **7-10** | å¤æ‚ | éœ€è¦æ˜ç¡®æ‰¹å‡† |

**DEFAULT**: Always choose â‰¤3/10 complexity solutions

**Example:**
```markdown
COMPLEXITY ASSESSMENT:
- Solution Complexity: 2/10
- Justification: Reuses existing ChatView pattern, only adds one new method
- Existing Pattern: Similar to `renderMessage()` in ChatView.ts:200-220
```

### Rule 3: Simplicity Challenge

**If solution has >3 implementation steps:**

```markdown
1. â“ Justify why 1-step solution won't work
   - Show evidence that simpler approach fails
   
2. â“ Justify why 2-step solution won't work
   - Explain what additional complexity is needed
   
3. â“ Show evidence that 3+ steps are actually needed
   - Cite similar complex solutions in codebase
   
4. âœ‹ Get explicit approval before proceeding
   - Wait for user confirmation
```

### Rule 4: Pattern Compliance

**For any new implementation:**

```markdown
1. âœ… Find 2-3 existing similar patterns in codebase
   - ChatView.ts: Uses ItemView for views
   - MarkdownRenderer.ts: Uses MarkdownRenderer.render()
   - main.ts: Uses Plugin lifecycle hooks
   
2. âœ… Show me how they work
   - Explain the pattern and its benefits
   
3. âœ… Use the SAME pattern unless you can prove it won't work
   - Consistency is more important than "better" approaches
   
4. âœ… If deviating from pattern, get explicit approval
   - Explain why deviation is necessary
   - Provide evidence that existing pattern fails
```

---

## ğŸ” Evidence Collection Process

### Step 1: Search for Existing Patterns

```bash
# Use grep to find similar implementations
grep -r "ItemView" src/
grep -r "MarkdownRenderer" src/

# Or use semantic search
# "How does chat view work in this project?"
# "Where is markdown rendering implemented?"
```

### Step 2: Analyze Existing Code

**Documentation Format:**
```markdown
EVIDENCE FOUND:
- File: `src/ChatView.ts:100-150`
- Pattern: Uses ItemView.onOpen() to initialize UI
- Context: Custom view needs to display content in sidebar
- Dependencies: 
  - Requires ItemView base class
  - Uses containerEl for DOM manipulation
  - Follows Obsidian plugin patterns
```

### Step 3: Document Evidence

**Code Citations:**
```typescript
// Based on existing pattern in src/ChatView.ts:100-150
// Following the same approach as src/KnowledgeBaseView.ts:50-70
// Using pattern established in src/main.ts:200-220
```

**Documentation Citations:**
```typescript
// Obsidian Documentation: https://docs.obsidian.md/Plugins/Views
// TypeScript Guide: https://www.typescriptlang.org/docs/
// CodeMirror 6: https://codemirror.net/docs/
```

---

## ğŸš« Prohibited Without Evidence

### Don't Assume

```markdown
âŒ "This pattern is wrong" (without showing why)
âŒ "This is the standard way" (without documentation)
âŒ "This will cause problems" (without evidence)
âŒ "This is better" (without comparison)
```

### Don't Invent

```markdown
âŒ New patterns without existing examples
âŒ New APIs without documentation
âŒ New architectures without justification
âŒ New conventions without precedent
```

**Example of BAD approach:**
```markdown
"We should use a complex state management library like Redux."
âŒ No evidence that current state management is failing
âŒ No similar patterns in existing codebase
âŒ Adds complexity without proven benefit
```

**Example of GOOD approach:**
```markdown
"We should continue using simple object state management."
âœ… Currently used in ChatView.ts:30-50
âœ… Simple and effective for our use case
âœ… Complexity: 2/10 (simple, consistent)
âœ… No evidence that current approach is insufficient
```

---

## âœ… Required With Evidence

### Always Show

```markdown
âœ… Existing working code that solves similar problems
âœ… File paths and line numbers for all references
âœ… Explanation of how existing patterns work
âœ… Justification for any deviations from existing patterns
```

### Always Cite

```markdown
âœ… Official documentation for all API usage
âœ… Existing project patterns for all architectural decisions
âœ… Verified sources for all best practices
âœ… Specific examples for all recommendations
```

---

## ğŸ“‹ Evidence Templates

### Existing Code Analysis

```markdown
EXISTING PATTERN ANALYSIS:
- File: `src/ChatView.ts`
- Lines: 100-150
- Pattern: ItemView-based custom view
- Context: Needs to display chat interface in sidebar
- Dependencies: ItemView, containerEl, Obsidian API
- Similarity: Solving same problem - custom UI in Obsidian

CONCLUSION:
- Reuse this pattern âœ…
- Complexity: 2/10
- No new abstractions needed
```

### Solution Justification

```markdown
SOLUTION JUSTIFICATION:
- Based on: `src/ChatView.ts:100-150`
- Pattern: ItemView with custom rendering
- Adaptation: Add new `renderDiff()` method
- Evidence: Same UI pattern, proven to work
- Complexity: 2/10 (minimal change to existing view)
```

### Deviation Justification

```markdown
DEVIATION JUSTIFICATION:
- Existing pattern: All views extend ItemView
- Why it won't work: This component needs to be a modal dialog
- Reason: Different UX requirement - overlay instead of sidebar
- Alternative approach: Use Modal class instead of ItemView
- Evidence: Similar pattern in Obsidian sample plugins
- Complexity: 3/10 (different base class but same patterns)
- Approval Required: âœ… No (still using Obsidian API patterns)
```

---

## ğŸ¯ Quality Gates

### Before Implementation

- [ ] **Evidence collected**: Found 2-3 existing similar patterns
- [ ] **Sources cited**: All references include file paths/line numbers
- [ ] **Patterns understood**: Can explain how existing code works
- [ ] **Complexity rated**: Solution rated 1-10, justified if >3
- [ ] **Pattern compliance**: Using existing project patterns
- [ ] **Justification complete**: Can explain why approach is appropriate

### During Implementation

- [ ] **Following evidence**: Implementation matches cited patterns
- [ ] **Maintaining consistency**: Using same approaches as existing code
- [ ] **Documenting decisions**: Adding comments explaining choices
- [ ] **No over-engineering**: Not adding unnecessary abstractions

### After Implementation

- [ ] **Verification complete**: Solution works as expected
- [ ] **Pattern consistency**: Follows established project patterns
- [ ] **Documentation updated**: Changes properly documented
- [ ] **No regressions**: Existing functionality still works

---

## ğŸš¨ Violation Consequences

### Missing Evidence

| Violation Type | Response |
|---------------|----------|
| **First violation** | Request evidence before proceeding |
| **Repeated violations** | Require evidence for all future decisions |
| **Pattern violations** | Require explicit approval for any deviations |

### False Evidence

| Issue Type | Action |
|-----------|--------|
| **Incorrect citations** | Correct immediately and verify all other citations |
| **Misleading patterns** | Explain actual pattern and adjust solution |
| **Outdated references** | Update to current documentation/patterns |

---

## ğŸ“š AIPilot Project Evidence Sources

### Primary Sources (Existing Code)
- **Views**: `src/ChatView.ts`, `src/KnowledgeBaseView.ts` - View patterns
- **Rendering**: `src/MarkdownRenderer.ts` - Markdown rendering
- **Services**: `src/services/`, `src/rag/` - Service patterns
- **Models**: `src/models/` - Model management
- **Main**: `src/main.ts` - Plugin lifecycle

### Secondary Sources (Documentation)
- **Project Docs**: `docs/` - Architecture, API, guides
- **Structure**: `docs/STRUCTURE.md` - Project organization
- **Architecture**: `docs/architecture/` - Design decisions

### External Sources
- **Obsidian API**: https://docs.obsidian.md/
- **TypeScript**: https://www.typescriptlang.org/docs/
- **CodeMirror**: https://codemirror.net/docs/

---

## ğŸ“Š Practical Examples

### âœ… Good Example: Following Existing Pattern

```markdown
USER: "We need to add a new view to display statistics."

AI RESPONSE:
EVIDENCE ANALYSIS:
- Existing: `ChatView.ts:30-100` extends ItemView
- Pattern: Custom view in sidebar
- Complexity: 2/10 (add one similar view)

PROPOSED SOLUTION:
```typescript
// Based on existing pattern in ChatView.ts:30-100
export class StatsView extends ItemView {
    getViewType() {
        return 'aipilot-stats';
    }
    
    getDisplayText() {
        return 'Statistics';
    }
    
    async onOpen() {
        const container = this.containerEl.children[1];
        container.empty();
        // Render stats...
    }
}
```

JUSTIFICATION:
- Reuses existing ItemView pattern
- Follows same structure as ChatView
- No new abstractions needed
```

### âŒ Bad Example: Over-Engineering

```markdown
USER: "We need to add a new view to display statistics."

AI RESPONSE (DON'T DO THIS):
"Let's create a complex component framework with:

```typescript
abstract class BaseComponent {
    abstract render(): void;
    abstract update(): void;
    // ... complex lifecycle
}

class ComponentRegistry { ... }
class ComponentFactory { ... }
```

This is more flexible and scalable..."

WHY THIS IS BAD:
âŒ No evidence of similar pattern in codebase
âŒ Adds unnecessary complexity (8/10 complexity)
âŒ Over-engineering a simple requirement
âŒ Invents new pattern without justification
```

---

**Remember**: Evidence-first approach prevents overengineering, ensures consistency, and builds on proven patterns rather than inventing new solutions. When in doubt, use existing patterns and keep it simple.

---

**æœ€åæ›´æ–°**: 2025-11-09  
**ç‰ˆæœ¬**: 1.0  
**é€‚é…è‡ª**: Epoch é¡¹ç›®è§„åˆ™ï¼ˆæ”¹é€ ä¸º TypeScript/Obsidian ç¯å¢ƒï¼‰
