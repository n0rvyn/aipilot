---
description: "TypeScript æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•"
scopes: [chat, edit]
tags: [typescript, types, best-practices]
priority: 101
globs: ["**/*.ts"]
alwaysApply: false
---

# TypeScript æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•

> **é‡è¦æ€§**: â­â­â­â­ é«˜ä¼˜å…ˆçº§  
> **åŠ è½½æ–¹å¼**: Auto-Attachï¼ˆç¼–è¾‘ TS æ–‡ä»¶æ—¶è‡ªåŠ¨åŠ è½½ï¼‰  
> **ç”¨é€”**: TypeScript ç±»å‹å®‰å…¨å’Œä»£ç è´¨é‡  

---

## ğŸ¯ ç±»å‹å®‰å…¨åŸåˆ™

### 1. é¿å…ä½¿ç”¨ `as any` âš ï¸

```typescript
// âŒ é”™è¯¯ï¼šä¸¢å¤±ç±»å‹å®‰å…¨
const data = response as any;
const value = data.someProperty; // æ— ç±»å‹æ£€æŸ¥

// âœ… æ­£ç¡®ï¼šå®šä¹‰æ˜ç¡®æ¥å£
interface ResponseData {
    someProperty: string;
    anotherProperty: number;
}

const data = response as ResponseData;
const value = data.someProperty; // ç±»å‹å®‰å…¨
```

**ä¾‹å¤–æƒ…å†µ**ï¼ˆéœ€è¦æ³¨é‡Šè¯´æ˜ï¼‰ï¼š
```typescript
// âœ… å¯æ¥å—ï¼šç¬¬ä¸‰æ–¹åº“æ— ç±»å‹å®šä¹‰
// @ts-ignore - marked library typing issue
const renderer = new marked.Renderer() as any;

// âœ… å¯æ¥å—ï¼šä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œæœ‰ TODO
// TODO: Define proper type for this API response
const temp = unknownData as any;
```

---

## ğŸ“ æ¥å£å®šä¹‰

### æ‰€æœ‰æ•°æ®ç»“æ„å¿…é¡»å®šä¹‰æ¥å£

```typescript
// âŒ é”™è¯¯ï¼šæ— ç±»å‹å®šä¹‰
const message = {
    role: 'user',
    content: 'Hello',
    timestamp: Date.now()
};

// âœ… æ­£ç¡®ï¼šå®šä¹‰æ¥å£
interface Message {
    role: 'user' | 'assistant' | 'system';
    content: string;
    timestamp: number;
}

const message: Message = {
    role: 'user',
    content: 'Hello',
    timestamp: Date.now()
};
```

### æ¥å£å‘½åè§„èŒƒ

```typescript
// âœ… æ¨èï¼šä½¿ç”¨ I å‰ç¼€æˆ–æè¿°æ€§åç§°
interface ISettings { ... }
interface UserSettings { ... }

// âœ… æ¨èï¼šä½¿ç”¨ Type åç¼€è¡¨ç¤ºç±»å‹åˆ«å
type ModelType = 'gpt-4' | 'gpt-3.5-turbo';
type ConfigType = { ... };

// âœ… æ¨èï¼šä½¿ç”¨ Enum è¡¨ç¤ºæšä¸¾
enum MessageRole {
    User = 'user',
    Assistant = 'assistant',
    System = 'system'
}
```

---

## ğŸ”§ ç±»å‹å·¥å…·

### 1. å¯é€‰é“¾ï¼ˆOptional Chainingï¼‰

```typescript
// âŒ ç¹ççš„ç©ºå€¼æ£€æŸ¥
if (obj && obj.prop && obj.prop.nested) {
    const value = obj.prop.nested.value;
}

// âœ… ä½¿ç”¨å¯é€‰é“¾
const value = obj?.prop?.nested?.value;
```

### 2. ç©ºå€¼åˆå¹¶ï¼ˆNullish Coalescingï¼‰

```typescript
// âŒ ä½¿ç”¨ || å¯èƒ½äº§ç”Ÿæ„å¤–ç»“æœ
const timeout = settings.timeout || 5000; // 0 ä¼šè¢«å½“ä½œ false

// âœ… ä½¿ç”¨ ?? åªå¤„ç† null/undefined
const timeout = settings.timeout ?? 5000; // 0 ä¸ä¼šè¢«æ›¿æ¢
```

### 3. ç±»å‹å®ˆå«ï¼ˆType Guardsï¼‰

```typescript
// âœ… ä½¿ç”¨ç±»å‹å®ˆå«
function isString(value: unknown): value is string {
    return typeof value === 'string';
}

function processValue(value: unknown) {
    if (isString(value)) {
        // value åœ¨è¿™é‡Œæ˜¯ string ç±»å‹
        console.log(value.toUpperCase());
    }
}
```

### 4. æ³›å‹ï¼ˆGenericsï¼‰

```typescript
// âœ… ä½¿ç”¨æ³›å‹å¤„ç†é€šç”¨é€»è¾‘
interface ApiResponse<T> {
    data: T;
    status: number;
    message: string;
}

async function fetchData<T>(url: string): Promise<ApiResponse<T>> {
    const response = await fetch(url);
    return response.json();
}

// ä½¿ç”¨æ—¶æŒ‡å®šå…·ä½“ç±»å‹
const result = await fetchData<User>('/api/user');
// result.data æ˜¯ User ç±»å‹
```

---

## ğŸ“¦ å¯¼å…¥å’Œå¯¼å‡º

### æ¨¡å—åŒ–æœ€ä½³å®è·µ

```typescript
// âœ… å‘½åå¯¼å‡ºï¼ˆæ¨èç”¨äºå·¥å…·å‡½æ•°ï¼‰
export function formatDate(date: Date): string { ... }
export function parseDate(str: string): Date { ... }

// âœ… é»˜è®¤å¯¼å‡ºï¼ˆæ¨èç”¨äºç±»å’Œä¸»è¦ç»„ä»¶ï¼‰
export default class MyPlugin extends Plugin { ... }

// âœ… ç±»å‹å¯¼å‡º
export type { Message, Settings };
export interface User { ... }

// âœ… æ‰¹é‡å¯¼å…¥
import { formatDate, parseDate } from './utils';
import type { Message, Settings } from './types';
```

### é¿å…å¾ªç¯ä¾èµ–

```typescript
// âŒ é”™è¯¯ï¼šA.ts ä¾èµ– B.tsï¼ŒB.ts ä¾èµ– A.ts

// âœ… æ­£ç¡®ï¼šå°†å…±äº«ç±»å‹æå–åˆ°ç‹¬ç«‹æ–‡ä»¶
// types.ts
export interface SharedType { ... }

// A.ts
import type { SharedType } from './types';

// B.ts
import type { SharedType } from './types';
```

---

## ğŸ¨ ä»£ç é£æ ¼

### 1. å˜é‡å£°æ˜

```typescript
// âœ… ä½¿ç”¨ const / letï¼Œé¿å… var
const API_KEY = 'xxx'; // å¸¸é‡
let counter = 0; // å¯å˜

// âŒ é¿å… var
var oldStyle = 'no'; // ä¸æ¨è
```

### 2. ç®­å¤´å‡½æ•°

```typescript
// âœ… æ¨èï¼šç®­å¤´å‡½æ•°
const add = (a: number, b: number): number => a + b;

// âœ… å¤šè¡Œæ—¶ä½¿ç”¨å¤§æ‹¬å·
const process = (data: Data): Result => {
    const cleaned = cleanData(data);
    return transform(cleaned);
};

// âœ… å¼‚æ­¥ç®­å¤´å‡½æ•°
const fetchUser = async (id: string): Promise<User> => {
    const response = await fetch(`/api/user/${id}`);
    return response.json();
};
```

### 3. è§£æ„èµ‹å€¼

```typescript
// âœ… å¯¹è±¡è§£æ„
const { apiKey, model, temperature } = settings;

// âœ… æ•°ç»„è§£æ„
const [first, second, ...rest] = items;

// âœ… å‚æ•°è§£æ„
function render({ title, content, author }: Article) {
    // ...
}

// âœ… å¸¦é»˜è®¤å€¼çš„è§£æ„
const { timeout = 5000, retries = 3 } = config;
```

### 4. æ¨¡æ¿å­—ç¬¦ä¸²

```typescript
// âœ… ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²
const message = `Hello, ${user.name}!`;
const url = `/api/user/${userId}/posts`;

// âœ… å¤šè¡Œå­—ç¬¦ä¸²
const html = `
    <div class="message">
        <h2>${title}</h2>
        <p>${content}</p>
    </div>
`;
```

---

## ğŸ”„ å¼‚æ­¥å¤„ç†

### 1. Async/Await

```typescript
// âœ… æ¨èï¼šasync/await
async function loadData() {
    try {
        const response = await fetch('/api/data');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Failed to load data:', error);
        throw error;
    }
}

// âŒ é¿å…ï¼šPromise é“¾ï¼ˆé™¤éå¿…è¦ï¼‰
function loadDataOld() {
    return fetch('/api/data')
        .then(response => response.json())
        .then(data => data)
        .catch(error => {
            console.error('Failed:', error);
        });
}
```

### 2. å¹¶å‘è¯·æ±‚

```typescript
// âœ… ä½¿ç”¨ Promise.all å¹¶å‘
async function loadMultiple() {
    const [users, posts, comments] = await Promise.all([
        fetchUsers(),
        fetchPosts(),
        fetchComments()
    ]);
    
    return { users, posts, comments };
}

// âœ… ä½¿ç”¨ Promise.allSettled å¤„ç†éƒ¨åˆ†å¤±è´¥
async function loadWithFallback() {
    const results = await Promise.allSettled([
        fetchUsers(),
        fetchPosts(),
        fetchComments()
    ]);
    
    return results
        .filter(r => r.status === 'fulfilled')
        .map(r => r.value);
}
```

---

## ğŸ¯ ç±»å‹æ–­è¨€

### ä½•æ—¶ä½¿ç”¨ç±»å‹æ–­è¨€

```typescript
// âœ… å¯æ¥å—ï¼šç¡®å®šç±»å‹æ¯” TypeScript æ¨æ–­çš„æ›´å…·ä½“
const element = document.querySelector('.my-element') as HTMLDivElement;

// âœ… å¯æ¥å—ï¼šç±»å‹æ”¶çª„
interface Cat { meow(): void; }
interface Dog { bark(): void; }

function handleAnimal(animal: Cat | Dog) {
    if ('meow' in animal) {
        (animal as Cat).meow();
    } else {
        (animal as Dog).bark();
    }
}

// âŒ é¿å…ï¼šç»•è¿‡ç±»å‹æ£€æŸ¥
const data = apiResponse as any; // å±é™©ï¼

// âœ… æ›´å¥½ï¼šå®šä¹‰æ­£ç¡®çš„ç±»å‹
interface ApiResponse {
    data: unknown;
}
const response = apiResponse as ApiResponse;
```

---

## ğŸ” å¸¸è§æ¨¡å¼

### 1. å•ä¾‹æ¨¡å¼

```typescript
class ServiceManager {
    private static instance: ServiceManager;
    
    private constructor() {
        // ç§æœ‰æ„é€ å‡½æ•°
    }
    
    static getInstance(): ServiceManager {
        if (!ServiceManager.instance) {
            ServiceManager.instance = new ServiceManager();
        }
        return ServiceManager.instance;
    }
}
```

### 2. å·¥å‚æ¨¡å¼

```typescript
interface Model {
    generate(prompt: string): Promise<string>;
}

class ModelFactory {
    static create(type: string, config: Config): Model {
        switch (type) {
            case 'openai':
                return new OpenAIModel(config);
            case 'zhipu':
                return new ZhipuModel(config);
            default:
                throw new Error(`Unknown model type: ${type}`);
        }
    }
}
```

### 3. è§‚å¯Ÿè€…æ¨¡å¼

```typescript
type Listener<T> = (data: T) => void;

class EventEmitter<T> {
    private listeners: Listener<T>[] = [];
    
    on(listener: Listener<T>): void {
        this.listeners.push(listener);
    }
    
    off(listener: Listener<T>): void {
        const index = this.listeners.indexOf(listener);
        if (index > -1) {
            this.listeners.splice(index, 1);
        }
    }
    
    emit(data: T): void {
        this.listeners.forEach(listener => listener(data));
    }
}
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### ä»£ç æäº¤å‰æ£€æŸ¥

- [ ] **ç±»å‹å®‰å…¨**
  - [ ] é¿å…ä½¿ç”¨ `as any`ï¼ˆé™¤éå¿…è¦ä¸”æœ‰æ³¨é‡Šï¼‰
  - [ ] æ‰€æœ‰æ•°æ®ç»“æ„æœ‰æ˜ç¡®æ¥å£
  - [ ] ä½¿ç”¨æ³›å‹å¤„ç†é€šç”¨ç±»å‹

- [ ] **ä»£ç é£æ ¼**
  - [ ] ä½¿ç”¨ `const` / `let`ï¼Œé¿å… `var`
  - [ ] ä¼˜å…ˆä½¿ç”¨ç®­å¤´å‡½æ•°
  - [ ] ä½¿ç”¨å¯é€‰é“¾ `?.` å’Œç©ºå€¼åˆå¹¶ `??`
  - [ ] ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²å’Œè§£æ„èµ‹å€¼

- [ ] **å¼‚æ­¥å¤„ç†**
  - [ ] ä½¿ç”¨ async/await ä»£æ›¿ Promise é“¾
  - [ ] æ‰€æœ‰ async å‡½æ•°æœ‰é”™è¯¯å¤„ç†
  - [ ] å¹¶å‘è¯·æ±‚ä½¿ç”¨ Promise.all

- [ ] **æ¨¡å—åŒ–**
  - [ ] å¯¼å…¥å¯¼å‡ºæ¸…æ™°
  - [ ] é¿å…å¾ªç¯ä¾èµ–
  - [ ] ç±»å‹å•ç‹¬å¯¼å‡º

- [ ] **ç¼–è¯‘æ£€æŸ¥**
  - [ ] æ—  TypeScript é”™è¯¯
  - [ ] æ—  linter è­¦å‘Š
  - [ ] æ„å»ºæˆåŠŸ

---

## ğŸ”— ç›¸å…³èµ„æº

- **TypeScript å®˜æ–¹æ–‡æ¡£**: https://www.typescriptlang.org/docs/
- **TypeScript Deep Dive**: https://basarat.gitbook.io/typescript/
- **TypeScript Cheatsheet**: https://www.typescriptlang.org/cheatsheets

---

**æœ€åæ›´æ–°**: 2025-11-09  
**ç‰ˆæœ¬**: 1.0  
**Token ä¼°ç®—**: ~800 tokens  
**åŠ è½½æ–¹å¼**: Auto-Attach  
**ä¼˜å…ˆçº§**: 101
