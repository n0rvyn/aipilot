---
description: "结构化决策流程（处理复杂问题、多方案对比）"
scopes: [chat, edit]
tags: [decision-making, complex-problems, solution-comparison]
priority: 4
globs: ["**/*.ts", "**/*.js"]
alwaysApply: true
---

# 结构化决策流程

> **重要性**: ⭐⭐⭐⭐ 高优先级  
> **加载方式**: Always Applied  
> **用途**: 处理复杂问题、多方案对比、架构级决策  

---

## 🎯 何时使用

### 触发场景（满足任一即可）

**场景 1: 多疑点问题**
- 用户提出的问题包含 2+ 个不确定因素
- 涉及多个技术选型或设计决策
- 需要分析多个子问题才能解答

**场景 2: 方案对比需求**
- 用户明确要求对比多个方案
- 关键词：对比、选择、哪个更好、优缺点
- 涉及架构级或影响重大的决策

**场景 3: 不确定性高**
- 问题涉及新技术、未验证的方案
- 多个技术路径可选，需权衡取舍
- 需要综合考虑成本、时间、风险等因素

---

## 📋 标准输出格式

### 1️⃣ 疑点识别

**结论先行**（金字塔原理）：
```markdown
我识别出 X 个关键疑点需要逐一分析：

- ❓ **疑点 1**: [简短描述] - [为什么这是疑点]
- ❓ **疑点 2**: [简短描述] - [为什么这是疑点]
- ❓ **疑点 3**: [简短描述] - [为什么这是疑点]
```

**检查清单**：
- [ ] 每个疑点都明确描述了不确定性
- [ ] 疑点之间相互独立（不重叠）
- [ ] 疑点按重要性排序（关键疑点优先）

---

### 2️⃣ 方案矩阵

对每个疑点，提供 **2-3 个方案** + **推荐度**：

```markdown
#### ❓ 疑点 1: [具体描述]

| 方案 | 推荐度 | 核心优势 | 核心劣势 | 主要风险 | 适用场景 |
|------|--------|---------|---------|---------|---------|
| **A** | ⭐⭐⭐⭐⭐ | 简单快速、成本低 | 扩展性有限 | 未来需重构 | 当前阶段 |
| **B** | ⭐⭐⭐ | 扩展性强、长期稳定 | 实现复杂、周期长 | 过度设计 | 已验证需求 |
| **C** | ⭐⭐ | 折中方案 | 两头不靠 | 技术债务 | 快速试错 |

**💡 推荐**: 方案 A

**📝 理由**:
1. **符合当前需求** - 功能明确，不需要过度设计
2. **技术可行性高** - 基于已有技术栈，团队熟悉
3. **风险可控** - 即使未来需重构，成本也在可接受范围
4. **证据支持** - 项目中有类似实现，已验证可行

**⚠️ 不推荐理由**:
- 方案 B: 过度设计，不符合防止过度设计原则
- 方案 C: 无明显优势，技术债务高
```

**检查清单**：
- [ ] 每个方案都有明确的推荐度（⭐1-5）
- [ ] 优劣势基于客观事实，非主观臆断
- [ ] 推荐理由包含证据支持（文档、历史案例、测试数据）
- [ ] 明确说明"为什么不推荐"其他方案

---

### 3️⃣ 逐项讨论

**等待用户决策**，标记状态：

```markdown
## 🗳️ 决策进展

| 疑点 | 状态 | 用户决策 | 备注 |
|------|------|---------|------|
| 疑点 1 | ✅ 已决策 | 采用方案 A | - |
| 疑点 2 | 🔄 讨论中 | - | 需补充信息：XX |
| 疑点 3 | ⏸️  暂缓 | - | 依赖疑点 2 的结果 |
```

**AI 行为规则**：
- ✅ 每次只讨论 1 个疑点，等待用户明确决策
- ✅ 用户说"继续"/"下一个" → 标记当前疑点为 ✅，进入下一个
- ✅ 用户提出新问题 → 标记当前疑点为 🔄，深入讨论
- ❌ 禁止：未经用户确认就跳到下一个疑点
- ❌ 禁止：假设"用户可能想选 A"就继续

---

### 4️⃣ 综合整合

所有疑点讨论完后，输出：

```markdown
## 📊 决策摘要

| 疑点 | 最终方案 | 关键决策依据 |
|------|---------|-------------|
| 疑点 1 | 方案 A | 当前需求 + 技术可行性 |
| 疑点 2 | 方案 B | 用户明确要求 + 符合最佳实践 |
| 疑点 3 | 方案 A | 成本最优 + 风险可控 |

---

## 📝 实施计划大纲

### Phase 1: [阶段名称]
- [ ] Step 1: [具体操作]
- [ ] Step 2: [具体操作]

### Phase 2: [阶段名称]
- [ ] Step 3: [具体操作]
- [ ] Step 4: [具体操作]

---

## ⚠️ 综合风险清单

| 风险 | 可能性 | 影响 | 缓解措施 | 负责人 |
|------|--------|------|---------|--------|
| [风险描述] | 🟡 中 | 🔴 高 | [具体措施] | [User/AI] |

---

## 📄 关联文档

- 实施文档: `docs/xxx.md`（待更新）
- 相关文档: `docs/xxx.md`（参考）

---

## ✅ 下一步

用户批准后，AI 开始执行实施计划（遵循 207-task-execution-detailed.mdc）
```

---

## 🔍 快速自检清单

### AI 使用前检查

- [ ] 是否满足触发场景？（多疑点/方案对比/高不确定性）
- [ ] 是否主动询问用户："是否使用结构化决策流程？"

### 疑点识别阶段

- [ ] 疑点数量合理（2-5 个，不超过 7 个）
- [ ] 疑点相互独立，无重叠
- [ ] 疑点按重要性排序

### 方案对比阶段

- [ ] 每个疑点提供 2-3 个方案
- [ ] 推荐度基于客观评估（⭐1-5）
- [ ] 优劣势有证据支持（文档/测试/案例）
- [ ] 明确说明推荐和不推荐的理由

### 逐项讨论阶段

- [ ] 每次只讨论 1 个疑点
- [ ] 等待用户明确决策后才继续
- [ ] 记录决策状态（✅/🔄/⏸️）

### 综合整合阶段

- [ ] 所有疑点都已决策（无 🔄 或 ⏸️）
- [ ] 输出完整的决策摘要表格
- [ ] 提供可执行的实施计划大纲
- [ ] 列出风险清单和关联文档

---

## 🤖 AI 行为原则

### 主动识别复杂问题

**识别信号**：
- 用户问题包含：对比、选择、哪个更好、优缺点
- 用户问题涉及：架构设计、技术选型、重构方案
- 用户问题包含：多个、几种、怎么办

**AI 响应**：
```markdown
"我发现这是一个复杂问题，涉及 [X 个疑点]。
 
 是否使用结构化决策流程？这将帮助我们：
 1. 系统性地分析每个疑点
 2. 对比多个方案的优劣
 3. 基于证据做出推荐"
```

### 遵循辨证思考铁律

- ✅ 方案推荐基于证据（文档、测试数据、历史案例）
- ✅ 承认不确定性（"我不知道 X，建议验证"）
- ✅ 禁止模棱两可（不用"可能"、"大概"、"应该"）
- ✅ 优先实验验证（找不到文档 → 设计测试验证）

**详细参考**: `000-critical-rules.mdc` 的"AI 工作原则：辨证思考铁律"

---

**最后更新**: 2025-11-09  
**版本**: 1.0  
**Token 估算**: ~700 tokens  
**加载方式**: Always Applied  
**优先级**: 4
