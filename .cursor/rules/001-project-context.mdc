---
description: "é¡¹ç›®çŠ¶æ€ä¸ä¸Šä¸‹æ–‡ï¼ˆæ¯æ¬¡ä¼šè¯å¿…è¯»ï¼‰"
scopes: [chat, edit]
tags: [project-context, current-status]
priority: 2
globs: ["**/*.ts", "**/*.js"]
alwaysApply: true
---

# AIPilot é¡¹ç›®çŠ¶æ€

> **é‡è¦æ€§**: â­â­â­â­â­ æœ€é«˜ä¼˜å…ˆçº§  
> **åŠ è½½æ–¹å¼**: Always Applied  
> **ç”¨é€”**: è®© AI äº†è§£é¡¹ç›®å½“å‰çŠ¶æ€  

---

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

### åŸºæœ¬ä¿¡æ¯

- **é¡¹ç›®åç§°**: AIPilot
- **ç±»å‹**: Obsidian Plugin
- **å½“å‰ç‰ˆæœ¬**: v1.0.19
- **å¼€å‘è¯­è¨€**: TypeScript
- **æ„å»ºå·¥å…·**: esbuild
- **åŒ…ç®¡ç†**: npm

### æ ¸å¿ƒåŠŸèƒ½

1. **AI èŠå¤©ç•Œé¢** - æ”¯æŒå¤šä¸ª AI æä¾›å•†ï¼ˆOpenAIã€æ™ºè°±AIã€Groqï¼‰
2. **RAG çŸ¥è¯†åº“** - åˆ©ç”¨æœ¬åœ°ç¬”è®°ä½œä¸ºä¸Šä¸‹æ–‡å¢å¼º AI å›ç­”
3. **æ–‡æœ¬æ¶¦è‰²** - æ™ºèƒ½æ–‡æœ¬æ”¹è¿›ä¸å¯è§†åŒ–å·®å¼‚å¯¹æ¯”
4. **å¤šä»£ç†è¾©è®º** - ç”Ÿæˆå¤šè§†è§’è®¨è®ºå’Œåˆ†æ
5. **è‡ªå®šä¹‰åŠŸèƒ½** - åˆ›å»ºä¸ªæ€§åŒ– AI å·¥ä½œæµ
6. **èŠå¤©å†å²** - ä¿å­˜å’Œç®¡ç† AI å¯¹è¯è®°å½•

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯

```typescript
{
  "è¯­è¨€": "TypeScript 5.x",
  "æ¡†æ¶": "Obsidian Plugin API",
  "æ„å»º": "esbuild",
  "ç¼–è¾‘å™¨": "CodeMirror 6",
  "æ¸²æŸ“": "marked (Markdown)",
  "Tokenè®¡æ•°": "tiktoken",
  "HTTP": "axios"
}
```

### ä¸»è¦ä¾èµ–

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| obsidian | ^1.7.2 | Obsidian API |
| @codemirror/view | ^6.35.0 | ç¼–è¾‘å™¨è§†å›¾ |
| @codemirror/state | ^6.4.1 | ç¼–è¾‘å™¨çŠ¶æ€ |
| marked | ^14.1.3 | Markdown æ¸²æŸ“ |
| tiktoken | ^1.0.17 | Token è®¡æ•° |
| axios | ^1.7.7 | HTTP è¯·æ±‚ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
aipilot/
â”œâ”€â”€ src/                              # æºä»£ç 
â”‚   â”œâ”€â”€ main.ts                      # æ’ä»¶å…¥å£ï¼ˆ2000+ è¡Œï¼‰
â”‚   â”œâ”€â”€ ChatView.ts                  # èŠå¤©è§†å›¾ï¼ˆ2000+ è¡Œï¼‰
â”‚   â”œâ”€â”€ KnowledgeBaseView.ts         # çŸ¥è¯†åº“è§†å›¾
â”‚   â”œâ”€â”€ MarkdownRenderer.ts          # Markdown æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ icons.ts                     # å›¾æ ‡å®šä¹‰
â”‚   â”œâ”€â”€ modals.ts                    # æ¨¡æ€å¯¹è¯æ¡†
â”‚   â”œâ”€â”€ styles.css                   # æ ·å¼è¡¨
â”‚   â”œâ”€â”€ debate/                      # å¤šä»£ç†è¾©è®ºç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ AgentDebateEngine.ts
â”‚   â”‚   â””â”€â”€ DebatePanel.ts
â”‚   â”œâ”€â”€ models/                      # æ¨¡å‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ModelManager.ts
â”‚   â”‚   â”œâ”€â”€ ModelConfigModal.ts
â”‚   â”‚   â””â”€â”€ EmbeddingModelConfigModal.ts
â”‚   â”œâ”€â”€ rag/                         # RAG ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ AIService.ts
â”‚   â”‚   â”œâ”€â”€ RAGService.ts
â”‚   â”‚   â”œâ”€â”€ enhancement/
â”‚   â”‚   â”œâ”€â”€ ranking/
â”‚   â”‚   â”œâ”€â”€ reflection/
â”‚   â”‚   â””â”€â”€ retrieval/
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ AIService.ts
â”‚       â””â”€â”€ RAGService.ts
â”œâ”€â”€ docs/                            # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README.md                    # æ–‡æ¡£ä¸­å¿ƒ
â”‚   â”œâ”€â”€ STRUCTURE.md                 # é¡¹ç›®ç»“æ„
â”‚   â”œâ”€â”€ architecture/                # æ¶æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ api/                         # API æ–‡æ¡£
â”‚   â”œâ”€â”€ guides/                      # ä½¿ç”¨æŒ‡å—
â”‚   â””â”€â”€ development/                 # å¼€å‘æ–‡æ¡£
â”œâ”€â”€ dist/                            # æ„å»ºè¾“å‡º
â”œâ”€â”€ manifest.json                    # æ’ä»¶æ¸…å•
â”œâ”€â”€ package.json                     # npm é…ç½®
â””â”€â”€ esbuild.config.mjs              # æ„å»ºé…ç½®
```

---

## ğŸ¯ å½“å‰çŠ¶æ€

### å¼€å‘é˜¶æ®µ

- âœ… **æ ¸å¿ƒåŠŸèƒ½å®Œæˆ** - æ‰€æœ‰ä¸»è¦åŠŸèƒ½å·²å®ç°
- âœ… **ç¨³å®šç‰ˆæœ¬** - v1.0.19 å·²å‘å¸ƒ
- ğŸ”„ **æŒç»­ä¼˜åŒ–** - æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒæ”¹è¿›ä¸­

### æœ€è¿‘å˜æ›´ï¼ˆ2025-11ï¼‰

- 2025-11-09: å»ºç«‹ Cursor è§„åˆ™ä½“ç³»ï¼ˆä¸‰å±‚æ¶æ„ï¼‰
- 2025-11-09: æ›´æ–°æ–‡æ¡£ç»“æ„

---

## ğŸ“š å…³é”®æ–‡æ¡£ç´¢å¼•

### æ¶æ„ä¸è®¾è®¡

- **é¡¹ç›®ç»“æ„**: `docs/STRUCTURE.md`
- **æ¶æ„æ€»è§ˆ**: `docs/architecture/overview.md`
- **RAG ç³»ç»Ÿ**: `docs/architecture/rag-system.md`
- **è¾©è®ºç³»ç»Ÿ**: `docs/architecture/debate-system.md`
- **æ•°æ®æµ**: `docs/architecture/data-flow.md`

### API æ–‡æ¡£

- **ä¸»æ’ä»¶**: `docs/api/main-plugin.md`
- **èŠå¤©è§†å›¾**: `docs/api/chat-view.md`
- **RAG æœåŠ¡**: `docs/api/rag-service.md`
- **æ¨¡å‹ç®¡ç†**: `docs/api/model-manager.md`

### å¼€å‘æŒ‡å—

- **å¼€å‘ç¯å¢ƒ**: `docs/development/setup.md`
- **æ„å»ºæµç¨‹**: `docs/development/build-process.md`
- **è´¡çŒ®æŒ‡å—**: `docs/development/contributing.md`
- **æµ‹è¯•æŒ‡å—**: `docs/development/testing.md`

---

## ğŸ” ä»£ç æ¨¡å¼å‚è€ƒ

### æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

```typescript
// src/main.ts
export default class AIPilot extends Plugin {
    settings: AIPilotSettings;
    
    async onload() {
        // åŠ è½½è®¾ç½®
        await this.loadSettings();
        
        // æ³¨å†Œè§†å›¾
        this.registerView(VIEW_TYPE_CHAT, ...);
        
        // æ³¨å†Œå‘½ä»¤
        this.addCommand({ ... });
        
        // æ³¨å†Œè®¾ç½®é¢æ¿
        this.addSettingTab(new AIPilotSettingTab(this.app, this));
    }
    
    onunload() {
        // æ¸…ç†èµ„æº
    }
}
```

### è§†å›¾æ¨¡å¼

```typescript
// src/ChatView.ts
export class ChatView extends ItemView {
    getViewType() {
        return VIEW_TYPE_CHAT;
    }
    
    getDisplayText() {
        return "AI Chat";
    }
    
    async onOpen() {
        // åˆå§‹åŒ– UI
        this.containerEl.empty();
        this.containerEl.addClass('aipilot-chat-view');
    }
    
    async onClose() {
        // æ¸…ç†èµ„æº
    }
}
```

### è®¾ç½®æ¨¡å¼

```typescript
// src/main.ts
interface AIPilotSettings {
    apiProvider: 'openai' | 'zhipu' | 'groq';
    apiKey: string;
    model: string;
    // ...
}

const DEFAULT_SETTINGS: AIPilotSettings = {
    apiProvider: 'openai',
    apiKey: '',
    model: 'gpt-4',
};
```

### DOM æ“ä½œæ¨¡å¼

```typescript
// âœ… æ¨èï¼šä½¿ç”¨ Obsidian API
const container = this.containerEl.createDiv({ cls: 'chat-container' });
const header = container.createEl('h2', { text: 'AI Chat' });
const input = container.createEl('input', {
    type: 'text',
    placeholder: 'Type your message...'
});

// âŒ ç¦æ­¢ï¼šç›´æ¥æ“ä½œ innerHTML
container.innerHTML = '<div>...</div>'; // ä¸å®‰å…¨ï¼
```

---

## ğŸš¨ å·²çŸ¥çº¦æŸ

### Obsidian æ’ä»¶ç‰¹å®šçº¦æŸ

1. **å®‰å…¨æ€§**
   - ç¦æ­¢ä½¿ç”¨ `innerHTML` / `outerHTML`
   - å¿…é¡»æ¸…ç†ç”¨æˆ·è¾“å…¥
   - ä½¿ç”¨ Obsidian DOM API

2. **æ€§èƒ½**
   - é¿å…é˜»å¡ä¸»çº¿ç¨‹
   - å¤§æ–‡ä»¶å¤„ç†ä½¿ç”¨å¼‚æ­¥
   - åŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬

3. **å…¼å®¹æ€§**
   - å…¼å®¹ Obsidian 1.0+
   - è€ƒè™‘ç§»åŠ¨ç«¯å…¼å®¹æ€§
   - æµ‹è¯•å¤šä¸»é¢˜å…¼å®¹æ€§

### TypeScript çº¦æŸ

1. **ç±»å‹å®‰å…¨**
   - é¿å… `as any`
   - å®šä¹‰æ˜ç¡®æ¥å£
   - ä½¿ç”¨æ³›å‹å¤„ç†é€šç”¨ç±»å‹

2. **ä»£ç é£æ ¼**
   - ä½¿ç”¨ `const` / `let`ï¼Œé¿å… `var`
   - ä¼˜å…ˆä½¿ç”¨ç®­å¤´å‡½æ•°
   - ä½¿ç”¨å¯é€‰é“¾ `?.` å’Œç©ºå€¼åˆå¹¶ `??`

---

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# ç‰ˆæœ¬å‘å¸ƒ
npm version patch/minor/major
```

### æµ‹è¯•æµç¨‹

1. åœ¨æœ¬åœ° Obsidian vault æµ‹è¯•
2. éªŒè¯æ ¸å¿ƒåŠŸèƒ½
3. æ£€æŸ¥æ§åˆ¶å°æ— é”™è¯¯
4. æµ‹è¯•å¤šä¸ª AI æä¾›å•†
5. éªŒè¯ RAG åŠŸèƒ½

---

## ğŸ“ å¸¸è§ä»»åŠ¡

### æ·»åŠ æ–°åŠŸèƒ½

1. åˆ†æéœ€æ±‚ï¼ˆå±äºå“ªä¸ªæ¨¡å—ï¼‰
2. åˆ¶å®šè®¡åˆ’ï¼ˆ2-3 ä¸ªæ–¹æ¡ˆï¼‰
3. ç­‰å¾…æ‰¹å‡†
4. å®æ–½ä»£ç 
5. æ›´æ–°æ–‡æ¡£
6. æµ‹è¯•éªŒè¯

### ä¿®å¤ Bug

1. é‡ç°é—®é¢˜
2. å®šä½ä»£ç 
3. åˆ†æåŸå› 
4. å®æ–½ä¿®å¤
5. éªŒè¯ä¿®å¤
6. æ·»åŠ æµ‹è¯•ï¼ˆå¦‚é€‚ç”¨ï¼‰

### é‡æ„ä»£ç 

1. è¯†åˆ«é—®é¢˜ä»£ç 
2. æå‡ºé‡æ„æ–¹æ¡ˆ
3. è¯„ä¼°é£é™©
4. ç­‰å¾…æ‰¹å‡†
5. é€æ­¥é‡æ„
6. ç¡®ä¿åŠŸèƒ½ä¸å˜

---

## ğŸŒ å¤–éƒ¨èµ„æº

### å®˜æ–¹æ–‡æ¡£
- **Obsidian API**: https://docs.obsidian.md/
- **TypeScript**: https://www.typescriptlang.org/docs/
- **CodeMirror 6**: https://codemirror.net/docs/

### ç¤¾åŒºèµ„æº
- **Obsidian Plugin Docs**: https://marcus.se.net/obsidian-plugin-docs/
- **Obsidian Forum**: https://forum.obsidian.md/

---

**æœ€åæ›´æ–°**: 2025-11-09  
**ç‰ˆæœ¬**: 1.0  
**Token ä¼°ç®—**: ~1,500 tokens  
**åŠ è½½æ–¹å¼**: Always Applied  
**ä¼˜å…ˆçº§**: 2
