---
description: "任务执行红线 - 详细参考"
scopes: [chat, edit]
tags: [task-execution-redline, detailed-reference]
priority: 207
globs: []
alwaysApply: false
---

# 任务执行红线（Task Execution Red Line）- 详细参考

> **注意**：本文件为详细参考，不会自动加载。  
> **核心铁律**：见 `000-critical-rules.mdc` 的"任务执行红线"部分

---

> **来源**: Epoch 项目经验教训  
> **严重性**: 🔴 P0 - 绝对禁止  
> **优先级**: ⭐⭐⭐⭐⭐ 最高  

---

## 🚨 核心铁律（100字）

**铁律：计划中的每个步骤必须逐项完成并验收，不得跳过。任何步骤失败或未完成时，立即停止所有工作，明确报告问题，等待用户明确允许后才能继续下一步。禁止擅自决定"先做其他的"或"这步可以跳过"。**

---

## 📋 四大原则

### 1️⃣ 必须逐项执行

```markdown
✅ 正确：
Step 1 → 完成并验收 → Step 2 → 完成并验收 → Step 3

❌ 错误：
Step 1 → 失败 → 跳过 → Step 2 继续
Step 1 → 部分完成 → "先做 Step 2，回头再补"
```

**规则**：
- 每个步骤必须完整完成
- 必须经过验收确认
- 不能"部分完成"就继续

---

### 2️⃣ 失败时必须停止

```markdown
✅ 正确：
任务失败 → 立即报告 → 询问："是否需要重试？还是继续其他任务？" → 等待明确指示

❌ 错误：
任务失败 → 在文档中标记"pending" → 准备继续下一个任务
任务失败 → 自己决定"先做其他的，这个后面再说"
```

**必须询问**：
```markdown
"Step X 失败了（[具体原因]），是否需要：
  A. 重试该步骤
  B. 检查问题原因
  C. 继续下一步（说明风险）"
```

**禁止行为**：
- ❌ 自己决定"先做其他的"
- ❌ 标记为"pending"就继续
- ❌ 假设"用户可能想..."

---

### 3️⃣ 验收标准明确

#### 编译验证

```bash
# ✅ 正确：实际运行 build
npm run build
# 等待结果
# 必须看到 Build succeeded 或类似成功消息

# ❌ 错误
- "linter 没报错" ❌ 不算编译通过
- "应该没问题" ❌ 必须实际验证
- "上次能过" ❌ 这次也必须跑
```

#### 功能测试

```markdown
# ✅ 正确：明确的测试结果
- 场景1：✅ 通过（在 Obsidian 中测试成功）
- 场景2：✅ 通过（功能正常工作）
- 场景3：❌ 失败（具体错误信息）

# ❌ 错误
- "基本功能可用" ❌ 太模糊
- "差不多了" ❌ 必须明确结果
```

#### 部署验证

```bash
# ✅ 正确：确认服务运行
# 检查文件是否正确部署
# 验证功能是否可访问

# ❌ 错误
- "文件已复制" ❌ 不代表部署成功
- "应该部署上了" ❌ 必须验证
```

---

### 4️⃣ 等待明确允许

#### 必须等待用户明确说

```markdown
✅ 明确的允许：
- "继续下一步"
- "跳过这个，做其他的"
- "Option A" / "Option B"
- "执行"、"开整"

❌ 不能自己推测：
- "用户可能想先看结果，所以我先做 X"
- "这个不重要，先做其他的"
- "部署失败了，但我可以继续更新文档"
```

#### 需要用户操作的场景

```markdown
当遇到以下情况，必须停止并等待：
1. 功能测试（需用户在 Obsidian 中测试）
2. UI 验证（需用户确认效果）
3. API Key 配置（需用户提供）
4. 决策选择（需用户判断方案）

报告模板：
"Step X 需要您的操作：
 - 具体操作：[详细步骤]
 - 预计时间：[X 分钟]
 - 完成后请反馈结果，我再继续后续步骤"

⏸️  等待用户反馈...
```

---

## 🔴 常见违规场景

### 违规 1: 跳过编译验证 ⚠️

**计划要求**：
```markdown
2. 编译验证
   - 运行 npm run build
   - 确保无编译错误
```

**错误行为**：
- ❌ 只看了 linter errors
- ❌ 没有运行 build
- ❌ 直接声称"代码编译通过"
- ❌ 直接进入下一步

**正确做法**：
```bash
# 必须实际运行
npm run build

# 看到成功消息后才能继续
# 如：Build succeeded, Output: dist/main.js
```

---

### 违规 2: 失败后继续 ⚠️

**时间线**：
1. 第一次构建失败（TypeScript 错误）
2. AI 在文档中标记"build pending"
3. ❌ AI 准备继续下一个任务（文档更新）
4. 用户制止

**正确做法**：
```markdown
1. 第一次构建失败
2. 🛑 立即停止所有工作
3. 报告："构建失败了（TypeScript 类型错误），是否需要我：
   - Option A: 修复错误并重试
   - Option B: 检查具体问题
   - Option C: 继续其他任务（风险：代码不可用）"
4. ⏸️  等待用户选择
```

---

### 违规 3: 跳过功能测试 ⚠️

**计划要求**：
```markdown
3. 功能测试
   - 在 Obsidian 中测试聊天功能
   - 验证 Markdown 渲染
   - 测试流式响应
```

**错误行为**：
- ❌ 完全没有提及功能测试
- ❌ 直接进入文档更新
- ❌ 自己决定"这个需要用户操作，先做其他的"

**正确做法**：
```markdown
1. 完成代码修改 ✅
2. 完成编译验证 ✅
3. 🛑 停止
4. 生成详细的测试清单
5. 报告："功能测试需要您在 Obsidian 中操作，我已生成测试清单：
   - 3 个测试场景，预计 10 分钟
   - 请完成测试后反馈结果，我再继续后续步骤"
6. ⏸️  等待测试结果
```

---

## ✅ 正确的工作流程示例

### 场景：执行 5 步修复计划

```markdown
计划：
1. 修改代码
2. 编译验证
3. 功能测试
4. 更新文档
5. 提交代码
```

**执行流程**：

```
┌─────────────────────────────────┐
│ Step 1: 修改代码                │
│ - 修改 ChatView.ts              │
│ - 修改 MarkdownRenderer.ts      │
│ ✅ 完成，文件已保存              │
└─────────────────────────────────┘
         ↓
┌─────────────────────────────────┐
│ Step 2: 编译验证                │
│ - 运行 npm run build             │
│ - 结果：Build succeeded          │
│ ✅ 验收通过                      │
└─────────────────────────────────┘
         ↓
┌─────────────────────────────────┐
│ Step 3: 功能测试（需用户操作）  │
│                                  │
│ 🛑 停止并报告：                 │
│ "Step 2 完成，现在需要功能测试   │
│  测试清单：                      │
│  1. 打开 Obsidian                │
│  2. 测试聊天功能                 │
│  3. 验证 Markdown 渲染           │
│  预计 10 分钟，请完成后反馈"    │
│                                  │
│ ⏸️  等待测试结果...              │
└─────────────────────────────────┘
         ↓（用户反馈：3个场景通过）
┌─────────────────────────────────┐
│ Step 4: 更新文档                │
│ - 更新 STRUCTURE.md              │
│ - 更新 README.md                 │
│ ✅ 完成                          │
└─────────────────────────────────┘
         ↓
┌─────────────────────────────────┐
│ Step 5: 提交代码                │
│ - 提交信息：feat: improve chat  │
│ ✅ 全部完成！                    │
└─────────────────────────────────┘
```

---

## 📝 快速检查清单

**在继续下一步前，问自己**：

```markdown
□ 当前步骤是否 100% 完成？
  - ⚠️ "差不多"、"基本"、"应该" = 未完成

□ 是否有明确的验收证据？
  - ✅ 编译：Build succeeded
  - ✅ 测试：具体场景结果
  - ✅ 部署：文件已更新

□ 如果有问题，是否已停止并报告？
  - ⚠️ 任何失败 = 立即停止

□ 如果需要用户操作，是否已说明并等待？
  - ⚠️ 功能测试、UI 验证 = 等待反馈

□ 是否得到明确的"继续"指示？
  - ⚠️ 没有明确指示 = 不能继续
```

---

## 🎯 记住这句话

> **"任何步骤失败或未完成时，立即停止，等待明确允许。"**

---

## 🔗 相关规则

- **000-critical-rules.mdc**: 核心铁律（必须遵守）
- **002-ai-checklist.mdc**: 任务执行流程（工作流程）

---

**创建时间**: 2025-11-09  
**来源**: Epoch 项目经验教训（改造）  
**严重性**: 🔴 P0 - 违反此规则必须立即停止并反思  
**最后更新**: 2025-11-09
