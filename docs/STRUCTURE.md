# AIPilot é¡¹ç›®ç›®å½•ç»“æ„

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† AIPilot æ’ä»¶çš„å®Œæ•´ç›®å½•ç»“æ„ï¼Œç±»ä¼¼ `tree .` å‘½ä»¤çš„è¾“å‡ºã€‚

## ğŸ“ å®Œæ•´ç›®å½•æ ‘

```
aipilot/
â”œâ”€â”€ .obsidian/                         # Obsidian é…ç½®ç›®å½•ï¼ˆå¼€å‘ç”¨ï¼‰
â”œâ”€â”€ dist/                              # æ„å»ºè¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ main.js                       # ç¼–è¯‘åçš„ä¸»æ–‡ä»¶
â”‚   â”œâ”€â”€ manifest.json                 # æ’ä»¶æ¸…å•ï¼ˆå¤åˆ¶ï¼‰
â”‚   â””â”€â”€ styles.css                    # æ ·å¼æ–‡ä»¶ï¼ˆå¤åˆ¶ï¼‰
â”‚
â”œâ”€â”€ docs/                              # ğŸ“š æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README.md                     # æ–‡æ¡£ä¸­å¿ƒé¦–é¡µ
â”‚   â”œâ”€â”€ STRUCTURE.md                  # é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ architecture/                 # æ¶æ„æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ overview.md              # æ¶æ„æ€»è§ˆ
â”‚   â”‚   â”œâ”€â”€ plugin-lifecycle.md      # æ’ä»¶ç”Ÿå‘½å‘¨æœŸ
â”‚   â”‚   â”œâ”€â”€ rag-system.md            # RAG ç³»ç»Ÿè®¾è®¡
â”‚   â”‚   â”œâ”€â”€ debate-system.md         # å¤šä»£ç†è¾©è®ºç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ data-flow.md             # æ•°æ®æµè®¾è®¡
â”‚   â”œâ”€â”€ api/                         # API å‚è€ƒæ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ main-plugin.md           # ä¸»æ’ä»¶ API
â”‚   â”‚   â”œâ”€â”€ chat-view.md             # èŠå¤©è§†å›¾ API
â”‚   â”‚   â”œâ”€â”€ rag-service.md           # RAG æœåŠ¡ API
â”‚   â”‚   â”œâ”€â”€ model-manager.md         # æ¨¡å‹ç®¡ç† API
â”‚   â”‚   â””â”€â”€ debate-engine.md         # è¾©è®ºå¼•æ“ API
â”‚   â”œâ”€â”€ guides/                      # ä½¿ç”¨æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ getting-started.md       # å¿«é€Ÿå¼€å§‹
â”‚   â”‚   â”œâ”€â”€ configuration.md         # é…ç½®æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ custom-functions.md      # è‡ªå®šä¹‰åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ knowledge-base.md        # çŸ¥è¯†åº“ä½¿ç”¨
â”‚   â”‚   â””â”€â”€ agent-debate.md          # ä»£ç†è¾©è®ºåŠŸèƒ½
â”‚   â””â”€â”€ development/                 # å¼€å‘æ–‡æ¡£
â”‚       â”œâ”€â”€ setup.md                 # å¼€å‘ç¯å¢ƒæ­å»º
â”‚       â”œâ”€â”€ build-process.md         # æ„å»ºæµç¨‹
â”‚       â”œâ”€â”€ contributing.md          # è´¡çŒ®æŒ‡å—
â”‚       â”œâ”€â”€ testing.md               # æµ‹è¯•æŒ‡å—
â”‚       â””â”€â”€ release.md               # å‘å¸ƒæµç¨‹
â”‚
â”œâ”€â”€ src/                               # ğŸ”§ æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.ts                       # æ’ä»¶å…¥å£æ–‡ä»¶ï¼ˆ2000+ è¡Œï¼‰
â”‚   â”œâ”€â”€ main.ts.duplicates-removed    # ä»£ç é‡æ„å¤‡ä»½
â”‚   â”œâ”€â”€ main.ts.fixed                 # é”™è¯¯ä¿®å¤å¤‡ä»½
â”‚   â”‚
â”‚   â”œâ”€â”€ ChatView.ts                   # ğŸ’¬ èŠå¤©è§†å›¾ç»„ä»¶ï¼ˆ2000+ è¡Œï¼‰
â”‚   â”œâ”€â”€ KnowledgeBaseView.ts          # ğŸ“š çŸ¥è¯†åº“è§†å›¾ç»„ä»¶
â”‚   â”œâ”€â”€ MarkdownRenderer.ts           # ğŸ“ Markdown æ¸²æŸ“å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ icons.ts                      # ğŸ¨ å›¾æ ‡å®šä¹‰
â”‚   â”œâ”€â”€ modals.ts                     # ğŸªŸ æ¨¡æ€å¯¹è¯æ¡†ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ styles.css                    # ğŸ¨ æ ·å¼è¡¨
â”‚   â”œâ”€â”€ styles.d.ts                   # CSS æ¨¡å—ç±»å‹å£°æ˜
â”‚   â”œâ”€â”€ styles-import.ts              # æ ·å¼å¯¼å…¥
â”‚   â”œâ”€â”€ styles-import-test.ts         # æ ·å¼å¯¼å…¥æµ‹è¯•
â”‚   â”‚
â”‚   â”œâ”€â”€ debate/                       # ğŸ¤ å¤šä»£ç†è¾©è®ºç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ AgentDebateEngine.ts     # è¾©è®ºå¼•æ“æ ¸å¿ƒ
â”‚   â”‚   â””â”€â”€ DebatePanel.ts           # è¾©è®ºé¢æ¿ UI
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                       # ğŸ¤– æ¨¡å‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ModelManager.ts          # æ¨¡å‹é…ç½®ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ModelConfigModal.ts      # æ¨¡å‹é…ç½®å¯¹è¯æ¡†
â”‚   â”‚   â””â”€â”€ EmbeddingModelConfigModal.ts  # åµŒå…¥æ¨¡å‹é…ç½®å¯¹è¯æ¡†
â”‚   â”‚
â”‚   â”œâ”€â”€ rag/                          # ğŸ” RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ index.ts                 # RAG æ¨¡å—å…¥å£
â”‚   â”‚   â”œâ”€â”€ AIService.ts             # AI æœåŠ¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ RAGService.ts            # RAG æ ¸å¿ƒæœåŠ¡
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ enhancement/             # æŸ¥è¯¢å¢å¼º
â”‚   â”‚   â”‚   â”œâ”€â”€ HyDE.ts             # å‡è®¾æ–‡æ¡£åµŒå…¥
â”‚   â”‚   â”‚   â””â”€â”€ QueryRewriter.ts    # æŸ¥è¯¢é‡å†™å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ranking/                 # ç»“æœæ’åº
â”‚   â”‚   â”‚   â”œâ”€â”€ MMR.ts              # æœ€å¤§è¾¹é™…ç›¸å…³æ€§æ’åº
â”‚   â”‚   â”‚   â””â”€â”€ SemanticChunker.ts  # è¯­ä¹‰åˆ†å—å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ reflection/              # åæ€æœºåˆ¶
â”‚   â”‚   â”‚   â””â”€â”€ Reflector.ts        # åæ€å™¨ï¼ˆè‡ªæˆ‘è¯„ä¼°ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ retrieval/               # æ£€ç´¢æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ Retriever.ts        # åŸºç¡€æ£€ç´¢å™¨
â”‚   â”‚       â””â”€â”€ VectorRetriever.ts  # å‘é‡æ£€ç´¢å™¨
â”‚   â”‚
â”‚   â””â”€â”€ services/                     # ğŸ› ï¸ æœåŠ¡å±‚
â”‚       â”œâ”€â”€ AIService.ts             # AI æœåŠ¡å®ç°
â”‚       â””â”€â”€ RAGService.ts            # RAG æœåŠ¡å®ç°
â”‚
â”œâ”€â”€ test-icons/                        # ğŸ§ª å›¾æ ‡æµ‹è¯•
â”‚   â””â”€â”€ icon-test.html                # å›¾æ ‡å±•ç¤ºé¡µé¢
â”‚
â”œâ”€â”€ esbuild.config.mjs                 # âš™ï¸ esbuild æ„å»ºé…ç½®
â”œâ”€â”€ tsconfig.json                      # TypeScript é…ç½®
â”œâ”€â”€ types.d.ts                         # å…¨å±€ç±»å‹å£°æ˜
â”‚
â”œâ”€â”€ package.json                       # ğŸ“¦ é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ manifest.json                      # ğŸ”Œ Obsidian æ’ä»¶æ¸…å•
â”‚
â”œâ”€â”€ LICENSE                            # ğŸ“„ MIT è®¸å¯è¯
â”œâ”€â”€ README.md                          # é¡¹ç›®è¯´æ˜ï¼ˆè‹±æ–‡ï¼‰
â”œâ”€â”€ README.zh.md                       # é¡¹ç›®è¯´æ˜ï¼ˆä¸­æ–‡ï¼‰
â””â”€â”€ TODO.md                            # å¾…åŠäº‹é¡¹åˆ—è¡¨
```

## ğŸ“Š ç›®å½•ç»Ÿè®¡

### æºä»£ç åˆ†å¸ƒ

| ç›®å½• | æ–‡ä»¶æ•° | ä¸»è¦åŠŸèƒ½ |
|------|--------|----------|
| `src/` | 6 ä¸ªä¸»æ–‡ä»¶ | æ ¸å¿ƒåŠŸèƒ½å’Œ UI ç»„ä»¶ |
| `src/debate/` | 2 ä¸ªæ–‡ä»¶ | å¤šä»£ç†è¾©è®ºç³»ç»Ÿ |
| `src/models/` | 3 ä¸ªæ–‡ä»¶ | æ¨¡å‹é…ç½®ç®¡ç† |
| `src/rag/` | 3 ä¸ªä¸»æ–‡ä»¶ | RAG æ ¸å¿ƒæœåŠ¡ |
| `src/rag/enhancement/` | 2 ä¸ªæ–‡ä»¶ | æŸ¥è¯¢å¢å¼ºæŠ€æœ¯ |
| `src/rag/ranking/` | 2 ä¸ªæ–‡ä»¶ | ç»“æœæ’åºç®—æ³• |
| `src/rag/reflection/` | 1 ä¸ªæ–‡ä»¶ | è‡ªæˆ‘åæ€æœºåˆ¶ |
| `src/rag/retrieval/` | 2 ä¸ªæ–‡ä»¶ | å‘é‡æ£€ç´¢ |
| `src/services/` | 2 ä¸ªæ–‡ä»¶ | æœåŠ¡æ¥å£å®ç° |

### ä»£ç è§„æ¨¡

- **æ€»è¡Œæ•°**: çº¦ 6000+ è¡Œ TypeScript ä»£ç 
- **æœ€å¤§æ–‡ä»¶**: `main.ts` (~2000 è¡Œ)
- **ç¬¬äºŒå¤§æ–‡ä»¶**: `ChatView.ts` (~2000 è¡Œ)

## ğŸ—‚ï¸ å…³é”®æ–‡ä»¶è¯´æ˜

### é…ç½®æ–‡ä»¶

- **`manifest.json`** - Obsidian æ’ä»¶å…ƒæ•°æ®ï¼Œå®šä¹‰æ’ä»¶ IDã€åç§°ã€ç‰ˆæœ¬ç­‰
- **`package.json`** - npm é¡¹ç›®é…ç½®ï¼ŒåŒ…å«ä¾èµ–å’Œæ„å»ºè„šæœ¬
- **`tsconfig.json`** - TypeScript ç¼–è¯‘é…ç½®
- **`esbuild.config.mjs`** - æ„å»ºå·¥å…·é…ç½®ï¼ˆç”Ÿäº§/å¼€å‘æ¨¡å¼ï¼‰

### å…¥å£æ–‡ä»¶

- **`src/main.ts`** - æ’ä»¶ä¸»å…¥å£ï¼ŒåŒ…å«ï¼š
  - æ’ä»¶ç±»å®šä¹‰ï¼ˆ`AIPilot extends Plugin`ï¼‰
  - è®¾ç½®é¢æ¿ï¼ˆ`AIPilotSettingTab`ï¼‰
  - å„ç±»æ¨¡æ€æ¡†ï¼ˆPolishã€Historyã€Custom Function ç­‰ï¼‰
  - å‘½ä»¤æ³¨å†Œ
  - è§†å›¾æ³¨å†Œ

### æ ¸å¿ƒç»„ä»¶

- **`src/ChatView.ts`** - èŠå¤©ç•Œé¢è§†å›¾ï¼Œå®ç°ï¼š
  - æ¶ˆæ¯æ¸²æŸ“å’Œç®¡ç†
  - è‡ªå®šä¹‰åŠŸèƒ½æŒ‰é’®
  - æµå¼å“åº”å¤„ç†
  - å†å²è®°å½•ç®¡ç†

- **`src/KnowledgeBaseView.ts`** - çŸ¥è¯†åº“ä¾§è¾¹æ 
- **`src/MarkdownRenderer.ts`** - è‡ªå®šä¹‰ Markdown æ¸²æŸ“å™¨

### RAG ç³»ç»Ÿ

```
src/rag/
â”œâ”€â”€ RAGService.ts          # ç»Ÿä¸€çš„ RAG æœåŠ¡æ¥å£
â”œâ”€â”€ enhancement/           # æŸ¥è¯¢ä¼˜åŒ–
â”‚   â”œâ”€â”€ HyDE.ts           # ç”Ÿæˆå‡è®¾æ–‡æ¡£æé«˜æ£€ç´¢è´¨é‡
â”‚   â””â”€â”€ QueryRewriter.ts  # é‡å†™ç”¨æˆ·æŸ¥è¯¢
â”œâ”€â”€ retrieval/            # æ£€ç´¢å®ç°
â”‚   â””â”€â”€ VectorRetriever.ts # å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢
â”œâ”€â”€ ranking/              # ç»“æœä¼˜åŒ–
â”‚   â”œâ”€â”€ MMR.ts           # å»é‡å’Œå¤šæ ·æ€§
â”‚   â””â”€â”€ SemanticChunker.ts # æ™ºèƒ½åˆ†å—
â””â”€â”€ reflection/           # è´¨é‡æ§åˆ¶
    â””â”€â”€ Reflector.ts     # è¯„ä¼°ç­”æ¡ˆè´¨é‡å¹¶é‡è¯•
```

### è¾©è®ºç³»ç»Ÿ

```
src/debate/
â”œâ”€â”€ AgentDebateEngine.ts  # ç®¡ç†å¤šä¸ª AI ä»£ç†å¯¹è¯
â””â”€â”€ DebatePanel.ts        # è¾©è®º UI å’Œäº¤äº’
```

### æ¨¡å‹ç®¡ç†

```
src/models/
â”œâ”€â”€ ModelManager.ts              # ç»Ÿä¸€çš„æ¨¡å‹é…ç½®ç®¡ç†
â”œâ”€â”€ ModelConfigModal.ts          # LLM æ¨¡å‹é…ç½® UI
â””â”€â”€ EmbeddingModelConfigModal.ts # Embedding æ¨¡å‹é…ç½® UI
```

## ğŸ”„ æ„å»ºæµç¨‹

```
æºä»£ç  (src/*.ts)
    â†“
TypeScript ç¼–è¯‘ + esbuild æ‰“åŒ…
    â†“
è¾“å‡ºåˆ° dist/
    â”œâ”€â”€ main.js (æ‰€æœ‰ä»£ç æ‰“åŒ…)
    â”œâ”€â”€ manifest.json (å¤åˆ¶)
    â””â”€â”€ styles.css (å¤åˆ¶)
```

## ğŸ“ æ–‡æ¡£ç»„ç»‡åŸåˆ™

1. **architecture/** - ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„å†³ç­–
2. **api/** - ä»£ç çº§åˆ«çš„ API å‚è€ƒ
3. **guides/** - é¢å‘ç”¨æˆ·çš„ä½¿ç”¨æŒ‡å—
4. **development/** - é¢å‘å¼€å‘è€…çš„æŠ€æœ¯æ–‡æ¡£

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ¶æ„æ€»è§ˆ](architecture/overview.md) - äº†è§£ç³»ç»Ÿè®¾è®¡
- [å¼€å‘æŒ‡å—](development/setup.md) - å¼€å§‹å¼€å‘
- [API æ–‡æ¡£](api/main-plugin.md) - ä»£ç å‚è€ƒ

---

ğŸ’¡ **æç¤º**: ä½¿ç”¨ `tree` å‘½ä»¤å¯ä»¥åœ¨ç»ˆç«¯æŸ¥çœ‹å®é™…ç›®å½•ç»“æ„ï¼š
```bash
tree -L 3 -I 'node_modules|.git'
```

